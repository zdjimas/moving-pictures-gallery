 <!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KZAK ‚Ä¢ Frasier‚ÄëStyle Radio of music created by zdjimas and cjmurphy</title>
  <style>
    :root{ --ink:#e6e9ef; --muted:#9aa4b2; --brand:#89b4fa; --accent:#a6e3a1; --danger:#f38ba8; --bg1:#0a0e1a; --bg2:#111a33; --bg3:#0c1022; --card:#151a29; --line:#22324d; --shadow:0 18px 50px rgba(0,0,0,.45); }
    html,body{height:100%}
    body{margin:0;color:var(--ink);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:radial-gradient(1200px 600px at 70% -10%,#1a2550 0%,transparent 60%) fixed,linear-gradient(180deg,var(--bg1),var(--bg2) 55%,var(--bg3));overflow-y:overlay}
    .wrap{max-width:1000px;margin:0 auto;padding:28px 16px 100px;position:relative}

    header{display:flex;align-items:center;gap:14px;justify-content:space-between;margin:2px 0 18px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand .tower{width:28px;height:28px;border:2px solid #6aa2ff;border-radius:50%;position:relative;box-shadow:0 0 16px rgba(85,135,255,.45) inset}
    .brand .tower:after{content:"";position:absolute;left:50%;top:-6px;width:2px;height:16px;background:#6aa2ff;transform:translateX(-50%)}
    h1{font-weight:700;margin:0;font-size:20px;letter-spacing:.2px}
    .badge{font-size:12px;padding:4px 10px;border-radius:999px;border:1px solid #2a3958;background:#0d1222;color:var(--muted)}
    .onair{color:#1a0a0a;background:#ff2e2e;border-color:#6b1212;box-shadow:0 0 16px rgba(255,46,46,.35) inset,0 0 12px rgba(255,46,46,.25);font-weight:800;letter-spacing:.6px}
    .onair .dot{display:inline-block;width:8px;height:8px;margin-right:6px;border-radius:50%;background:#ffe9e9;animation:pulse 1.4s infinite}
    @keyframes pulse{0%{opacity:.4}50%{opacity:1}100%{opacity:.4}}

    .card{background:var(--card);border:1px solid var(--line);border-radius:20px;box-shadow:var(--shadow)}
    .radio{display:grid;grid-template-columns:1fr;gap:16px;padding:18px}
    .now{display:flex;align-items:center;gap:16px}
    .cover{width:92px;height:92px;border-radius:14px;background:linear-gradient(135deg,#202a41,#121827);display:flex;align-items:center;justify-content:center}
    .cover svg{opacity:.9}
    .meta{min-width:0}
    .title{font-size:18px;font-weight:700;margin:0 0 2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .subtitle{margin:0;color:var(--muted);font-size:12px}

    .controls{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    button{background:#0f131a;color:var(--ink);border:1px solid #2a3344;border-radius:999px;padding:10px 14px;cursor:pointer}
    .controls button{padding:10px 12px}
    button:disabled{opacity:.5;cursor:not-allowed}
    .primary{background:var(--brand);border-color:transparent;color:#061326;font-weight:700}
    .danger{background:#1a1012;border-color:#3a1a22;color:#ffdfe6}
    .toggle.active{background:var(--accent);border-color:transparent;color:#062211}
    .muted{background:#101010;border-color:#444}
    .vol{display:flex;align-items:center;gap:8px;margin-left:auto}
    .vol input{accent-color:#9dc2ff}

    .list{padding:10px;max-height:360px;overflow:auto;border-top:1px solid var(--line);border-radius:12px}
    .track{display:flex;align-items:center;gap:10px;padding:10px;border-radius:12px;border:1px solid transparent}
    .track:hover{background:#0f1524;border-color:#273553}
    .tidx{width:28px;height:28px;display:grid;place-items:center;background:#0c1016;border-radius:8px;color:#88a;font-size:12px}
    .tmeta{flex:1;min-width:0}
    .tmeta .ttitle{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .track.active{outline:2px solid #2d6cdf}

    footer{margin-top:10px;color:var(--muted);font-size:12px}

    .skyline{position:fixed;left:0;right:0;bottom:-4px;height:140px;pointer-events:none;opacity:.6}
    .skyline svg{width:100%;height:100%;display:block}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="tower" aria-hidden="true"></div>
        <h1>KSNO ‚Ä¢ Frasier‚ÄëStyle Jazz Radio</h1>
      </div>
      <div class="badge" id="status">idle</div>
    </header>

    <section class="card radio" aria-label="Local Radio Player">
      <div class="now">
        <div class="cover" aria-hidden="true">
          <svg viewBox="0 0 80 80" width="56" height="56" fill="none">
            <rect x="10" y="34" width="60" height="26" rx="6" stroke="#7aa2f7"/>
            <circle cx="24" cy="47" r="6" stroke="#7aa2f7"/>
            <rect x="38" y="43" width="22" height="8" rx="3" stroke="#7aa2f7"/>
            <path d="M50 34V18" stroke="#7aa2f7"/><circle cx="50" cy="16" r="2" fill="#7aa2f7"/>
          </svg>
        </div>
        <div class="meta">
          <p class="title" id="nowTitle">Nothing playing</p>
          <p class="subtitle" id="nowSub">Upload MP3s to <code>Media/</code> and press Start.</p>
        </div>
        <span class="badge onair" id="onAir" style="display:none"><span class="dot"></span>ON AIR</span>
      </div>

      <div class="controls" role="group" aria-label="Playback controls">
        <button id="btnPrev" aria-label="Previous" disabled>‚èÆÔ∏é</button>
        <button id="btnPlay" class="primary" aria-label="Play">‚ñ∂Ô∏é Start Station</button>
        <button id="btnNext" aria-label="Next" disabled>‚è≠Ô∏é</button>
        <button id="btnStop" class="danger" aria-label="Stop" disabled>‚ñ† Stop</button>
        <button id="btnShuffle" class="toggle" aria-pressed="false">Shuffle</button>
        <label style="display:flex;align-items:center;gap:6px"><input id="loopAll" type="checkbox" checked /> <span>Loop</span></label>
        <button id="btnMute" class="muted" aria-pressed="false" title="Mute (M)">üîá Mute</button>
        <span class="vol"><span>Vol</span> <input id="vol" type="range" min="0" max="1" step="0.01" value="0.8" /></span>
      </div>

      <div class="list" id="trackList" role="listbox" aria-label="Playlist"></div>

      <footer>
        <strong>Add songs:</strong> put MP3 files in <code>Media/</code> and edit the <code>PLAYLIST</code> below. Paths are case‚Äësensitive.
      </footer>

      <audio id="audio" preload="metadata" playsinline></audio>
    </section>
  </div>

  <div class="skyline" aria-hidden="true">
    <svg viewBox="0 0 1200 140" preserveAspectRatio="none">
      <defs><linearGradient id="sil" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stop-color="#1b264a"/><stop offset="100%" stop-color="#0a0f22"/></linearGradient></defs>
      <path fill="url(#sil)" d="M0,120 L80,120 L80,80 L120,80 L120,120 L170,120 L170,60 L190,60 L190,120 L260,120 L260,40 L270,40 L270,120 L350,120 L350,70 L365,70 L365,120 L430,120 L430,30 L435,30 L435,120 L520,120 L520,85 L560,85 L560,120 L620,120 L620,50 L640,50 L640,120 L700,120 L700,75 L735,75 L735,120 L810,120 L810,35 L815,35 L815,120 L900,120 L900,60 L930,60 L930,120 L1000,120 L1000,45 L1010,45 L1010,120 L1100,120 L1100,70 L1130,70 L1130,120 L1200,120 L1200,140 L0,140 Z"/>
      <rect x="300" y="20" width="4" height="60" fill="#2e4f9e"/><circle cx="302" cy="15" r="6" fill="#2e4f9e"/>
    </svg>
  </div>

  <script>
    // ===== Helper: encode each path segment (spaces, parentheses, etc.) =====
    function pathToUrl(rel){
      const segs = rel.split('/').map(s => encodeURIComponent(s));
      const joined = segs.join('/');
      const base = new URL('.', location.href); // current directory
      return new URL(joined, base).href;
    }

    // ========== Hard-coded local playlist (EXACT filenames) ==========
    const PLAYLIST = [
      { title: 'Fear Inoculum (Cover) v1', file: 'Media/Fear Inoculum (Cover) v1.mp3' },
      { title: 'Cover Of Wings For Marie (Part 1) v1', file: 'Media/Cover Of Wings For Marie (Part 1) v1.mp3' },
      { title: 'Bend the clock - 70s Barn Jam Edition', file: 'Media/Bend the clock - 70s Barn Jam Edition.mp3' },
      { title: 'More Guitars at Luna Park', file: 'Media/More Guitars at Luna Park.mp3' },
      { title: 'The Spirit Carries On (Live Rehearsal 2) (Remix)', file: 'Media/The Spirit Carries On (Live Rehearsal 2) (Remix).mp3' }
    ];

    const els = {
      audio: document.getElementById('audio'),
      status: document.getElementById('status'), onAir: document.getElementById('onAir'),
      nowTitle: document.getElementById('nowTitle'), nowSub: document.getElementById('nowSub'),
      list: document.getElementById('trackList'),
      btnPrev: document.getElementById('btnPrev'), btnPlay: document.getElementById('btnPlay'),
      btnNext: document.getElementById('btnNext'), btnStop: document.getElementById('btnStop'),
      btnShuffle: document.getElementById('btnShuffle'), loopAll: document.getElementById('loopAll'),
      btnMute: document.getElementById('btnMute'), vol: document.getElementById('vol')
    };

    let current = -1, isPlaying = false;
    const K = { vol:'radio.vol', muted:'radio.muted', shuffle:'radio.shuffle', loop:'radio.loop' };
    els.vol.value = localStorage.getItem(K.vol) || '0.8';
    els.audio.volume = parseFloat(els.vol.value);
    const savedMuted = JSON.parse(localStorage.getItem(K.muted)||'false');
    els.audio.muted = savedMuted; setMuteUi(savedMuted);
    let isShuffle = JSON.parse(localStorage.getItem(K.shuffle)||'false');
    if(isShuffle){ els.btnShuffle.classList.add('active'); els.btnShuffle.setAttribute('aria-pressed','true'); }
    const loopSaved = localStorage.getItem(K.loop); if(loopSaved!==null) els.loopAll.checked = loopSaved==='true';

    function renderList(){
      els.list.innerHTML = '';
      PLAYLIST.forEach((t,i)=>{
        const row = document.createElement('div'); row.className='track'; row.role='option'; row.tabIndex=0; row.dataset.idx=i;
        const link = pathToUrl(t.file);
        row.innerHTML = `<div class="tidx">${i+1}</div>
          <div class="tmeta">
            <div class="ttitle">${escapeHtml(t.title)}</div>
            <div class="subtitle"><a href="${link}" target="_blank" rel="noopener">${escapeHtml(t.file)}</a></div>
          </div>
          <button class="btn" title="Play">Play</button>`;
        row.querySelector('button').addEventListener('click', ()=> startAt(i));
        row.addEventListener('dblclick', ()=> startAt(i));
        row.addEventListener('keydown', e=>{ if(e.key==='Enter') startAt(i); });
        els.list.appendChild(row);
      });
      enableTransport(!!PLAYLIST.length); highlight();
      checkTracks();
    }

    function enableTransport(on){ els.btnPlay.disabled=!on; els.btnNext.disabled=!on; els.btnPrev.disabled=!on; els.btnStop.disabled=!on; }
    function highlight(){ [...els.list.children].forEach((c,idx)=> c.classList.toggle('active', idx===current)); }
    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }
    function notify(msg){ els.status.textContent = msg; }

    async function startAt(i){
      if(!PLAYLIST.length) return;
      current = i % PLAYLIST.length;
      const track = PLAYLIST[current];
      els.nowTitle.textContent = track.title; els.nowSub.textContent = 'Loading‚Ä¶';
      notify(`track ${current+1} / ${PLAYLIST.length}`); highlight();
      try{
        await attach(track.file); await els.audio.play();
        isPlaying = true; els.btnPlay.textContent='‚è∏Ô∏é Pause'; els.btnPlay.ariaLabel='Pause'; els.onAir.style.display=''; els.nowSub.textContent='Playing';
      }catch(err){ notify('Could not play this file. Skipping‚Ä¶'); next(); }
    }

    function attach(src){
      return new Promise((resolve,reject)=>{
        els.audio.pause(); els.audio.removeAttribute('src'); els.audio.load();
        const onMeta = ()=>{ els.audio.removeEventListener('loadedmetadata', onMeta); resolve(); };
        const onErr = ()=>{ els.audio.removeEventListener('error', onErr); reject(new Error('load error')); };
        els.audio.addEventListener('loadedmetadata', onMeta, { once:true });
        els.audio.addEventListener('error', onErr, { once:true });
        els.audio.src = pathToUrl(src); els.audio.load();
      });
    }

    function next(){ if(!PLAYLIST.length) return; if(isShuffle){ let n; do{ n=Math.floor(Math.random()*PLAYLIST.length); } while(PLAYLIST.length>1 && n===current); startAt(n); } else { const n=current+1; if(n<PLAYLIST.length) startAt(n); else if(els.loopAll.checked) startAt(0); else stopAll(); } }
    function prev(){ if(!PLAYLIST.length) return; if(isShuffle){ startAt(Math.floor(Math.random()*PLAYLIST.length)); } else { startAt((current-1+PLAYLIST.length)%PLAYLIST.length); } }
    function stopAll(){ els.audio.pause(); isPlaying=false; els.btnPlay.textContent='‚ñ∂Ô∏é Start Station'; els.btnPlay.ariaLabel='Play'; els.onAir.style.display='none'; notify('stopped'); }

    els.audio.addEventListener('ended', next);
    els.audio.addEventListener('error', ()=>{ notify('Playback error. Skipping‚Ä¶'); next(); });
    els.audio.addEventListener('waiting', ()=>{ els.nowSub.textContent='Buffering‚Ä¶'; });
    els.audio.addEventListener('playing', ()=>{ els.nowSub.textContent='Playing'; });

    els.btnPlay.addEventListener('click', ()=>{ if(isPlaying){ stopAll(); } else { if(current<0) startAt(0); else els.audio.play().catch(()=>startAt(current)); } });
    els.btnNext.addEventListener('click', next);
    els.btnPrev.addEventListener('click', prev);
    els.btnStop.addEventListener('click', stopAll);

    els.btnShuffle.addEventListener('click', ()=>{ isShuffle=!isShuffle; els.btnShuffle.classList.toggle('active', isShuffle); els.btnShuffle.setAttribute('aria-pressed', String(isShuffle)); localStorage.setItem(K.shuffle, JSON.stringify(isShuffle)); notify(isShuffle?'Shuffle: ON':'Shuffle: OFF'); });
    els.loopAll.addEventListener('change', ()=> localStorage.setItem(K.loop, els.loopAll.checked?'true':'false'));

    function setMuteUi(muted){ if(muted){ els.btnMute.textContent='üîä Sound On'; els.btnMute.classList.remove('muted'); els.btnMute.setAttribute('aria-pressed','true'); } else { els.btnMute.textContent='üîá Mute'; els.btnMute.classList.add('muted'); els.btnMute.setAttribute('aria-pressed','false'); } }
    els.btnMute.addEventListener('click', ()=>{ const m = !els.audio.muted; els.audio.muted = m; localStorage.setItem(K.muted, JSON.stringify(m)); setMuteUi(m); });
    els.vol.addEventListener('input', ()=>{ const v=parseFloat(els.vol.value||'0.8'); els.audio.volume=v; localStorage.setItem(K.vol, String(v)); });

    window.addEventListener('keydown', (e)=>{ if(['INPUT','TEXTAREA'].includes(document.activeElement.tagName)) return; if(e.code==='Space'){ e.preventDefault(); els.btnPlay.click(); } if(e.key==='n'||e.key==='N'){ e.preventDefault(); els.btnNext.click(); } if(e.key==='p'||e.key==='P'){ e.preventDefault(); els.btnPrev.click(); } if(e.key==='s'||e.key==='S'){ e.preventDefault(); els.btnShuffle.click(); } if(e.key==='m'||e.key==='M'){ e.preventDefault(); els.btnMute.click(); } });

    // Diagnostics: HEAD check with encoded URLs; show badge ok/404
    async function checkTracks(){
      const rows = [...els.list.children];
      await Promise.all(PLAYLIST.map(async (t, i)=>{
        const row = rows[i]; if(!row) return;
        const info = document.createElement('span'); info.className='badge'; info.style.marginLeft='8px'; info.textContent='checking‚Ä¶';
        row.querySelector('.tmeta').appendChild(info);
        try{
          const url = pathToUrl(t.file);
          const res = await fetch(url, { method:'HEAD', cache:'no-store' });
          if(res.ok){ info.textContent = 'ok'; info.style.background='#0f2012'; info.style.borderColor='#214d37'; }
          else{ info.textContent = '404?'; info.style.background='#3f1a1a'; info.style.borderColor='#6b2a2a'; }
        }catch(e){ info.textContent = 'fetch error'; info.style.background='#3f1a1a'; info.style.borderColor='#6b2a2a'; }
      }));
    }

    renderList();
  </script>
</body>
</html>

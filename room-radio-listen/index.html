 <!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KZAK ‚Ä¢ Frasier-Style Free Radio</title>
<style>
  :root{
    --ink:#e6e9ef; --muted:#9aa4b2; --brand:#89b4fa; --accent:#a6e3a1; --danger:#f38ba8;
    --card:#151a29; --line:#22324d; --shadow:0 18px 50px rgba(0,0,0,.45);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:#0a0e1a;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .bg{position:fixed;inset:0;pointer-events:none;opacity:.28;filter:saturate(.9);
      background:
        linear-gradient(180deg,rgba(10,14,26,.65),rgba(10,14,26,.92)),
        url('Media/RadioMusicListening.jpg') center/cover no-repeat;}
  .wrap{position:relative;max-width:1150px;margin:0 auto;padding:22px 18px 80px}

  header{display:flex;align-items:center;gap:12px;margin-bottom:14px}
  .header-logo{height:48px;vertical-align:middle;margin-right:6px;border-radius:6px}
  h1{font-size:clamp(20px,3.3vw,32px);margin:0;line-height:1.15}
  .return{margin-left:auto;text-decoration:none}
  .pill{background:#0f1628;border:1px solid var(--line);color:var(--ink);padding:8px 12px;border-radius:999px;font-size:12px;letter-spacing:.06em;text-transform:uppercase}
  .onair{display:inline-flex;align-items:center;gap:8px}
  .dot{width:8px;height:8px;background:#f66;border-radius:50%}

  .grid{display:grid;grid-template-columns:1fr min(440px,42%);gap:18px}
  .panel{background:var(--card);border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow)}
  .controls{padding:16px}
  .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  button{background:#0f1628;border:1px solid var(--line);color:var(--ink);padding:10px 12px;border-radius:12px;cursor:pointer}
  button:hover{border-color:#3a5279}
  .title{font-weight:600;margin-top:6px}
  .scrub{display:flex;align-items:center;gap:10px;margin-top:10px}
  input[type="range"]{width:100%}
  .meta{display:flex;justify-content:space-between;color:var(--muted);font-size:12px;margin-top:6px}

  aside.playlist{display:flex;flex-direction:column}
  aside h3{margin:14px 16px 8px;font-size:14px;color:var(--muted)}
  .list{height:430px;overflow:auto;-webkit-overflow-scrolling:touch;border-top:1px solid var(--line);border-bottom:1px solid var(--line)}
  .track{display:flex;gap:10px;align-items:flex-start;padding:10px 14px;border-bottom:1px solid var(--line);cursor:pointer}
  .track:hover{background:#0f1628}
  .idx{font-variant-numeric:tabular-nums;color:var(--muted);min-width:32px}
  .now{color:var(--accent)}
  .footer{padding:12px 16px;color:var(--muted);font-size:12px}

  .creators{margin-top:18px;display:grid;grid-template-columns:1fr 1fr;gap:18px}
  .card{padding:16px}
  .creator{display:flex;gap:12px;align-items:flex-start}
  .portrait{width:56px;height:56px;border-radius:10px;object-fit:cover;border:1px solid var(--line)}
  .small{color:var(--muted);font-size:12px}

  @media (max-width:900px){ .grid{grid-template-columns:1fr} .creators{grid-template-columns:1fr} }
</style>
</head>
<body>
<div class="bg" aria-hidden="true"></div>
<div class="wrap">
  <header>
    <img class="header-logo" src="Media/frasier.png" alt="Frasier badge" />
    <h1>KZAK ‚Ä¢ Frasier-Style Free Radio without the talking</h1>
    <a class="return pill" href="../index.html" aria-label="Return to Lobby">‚Üê Lobby</a>
    <span id="onAir" class="pill onair" aria-live="polite" title="Shows when audio is playing">ON AIR <span class="dot"></span></span>
  </header>

  <section class="grid">
    <!-- Left: Transport & timeline -->
    <div class="panel controls" role="region" aria-label="Player controls">
      <div class="row">
        <button id="btnPrev" aria-label="Previous track">‚èÆÔ∏é Prev</button>
        <button id="btnPlay" aria-label="Play">‚ñ∂Ô∏é Start Station</button>
        <button id="btnNext" aria-label="Next track">‚è≠Ô∏é Next</button>
        <button id="btnLoop" aria-label="Loop">‚ü≤ Loop</button>
        <button id="btnShuffle" aria-label="Shuffle">üîÄ Shuffle</button>
        <button id="btnMute" aria-label="Mute">üîá Mute</button>
        <input id="vol" type="range" min="0" max="1" step="0.01" value="0.9" aria-label="Volume"/>
      </div>

      <div id="title" class="title" aria-live="polite">‚Äî</div>

      <div class="scrub">
        <span id="elapsed" aria-label="Elapsed">0:00</span>
        <input id="seek" type="range" min="0" max="100" value="0" aria-label="Seek"/>
        <span id="remaining" aria-label="Remaining">-0:00</span>
      </div>

      <div class="meta">
        <span id="meta">Not playing</span>
        <span id="counter" class="pill">0 of 0</span>
      </div>

      <div class="row" style="margin-top:10px">
        <button id="btnShare" aria-label="Share current track">Share</button>
      </div>

      <audio id="audio" preload="metadata" crossorigin="anonymous"></audio>
    </div>

    <!-- Right: Playlist -->
    <aside class="panel playlist" role="region" aria-label="Playlist">
      <h3>Playlist</h3>
      <div id="list" class="list" role="listbox" aria-label="Track list"></div>
      <div class="footer">Use headphones ‚Ä¢ Filenames are case-sensitive ‚Ä¢ Share copies a deep link to the current track</div>
    </aside>
  </section>

  <!-- Creators -->
  <section class="creators">
    <div class="panel card">
      <div class="creator">
        <img class="portrait" src="Media/ZachArt.jpeg" alt="zdjimas portrait" />
        <div>
          <strong>zdjimas</strong><div class="small">Concept, curation, engineering</div>
        </div>
      </div>
    </div>
    <div class="panel card">
      <div class="creator">
        <img class="portrait" src="Media/CJMURPHY.png" alt="cjmurphy portrait" />
        <div>
          <strong>cjmurphy</strong><div class="small">Composition, arrangement, sound design</div>
        </div>
      </div>
    </div>
  </section>
</div>

<script>
/* =========================
   1) YOUR PLAYLIST
   =========================
   Paste your full PLAYLIST constant below in this same shape.
   I left a few demo tracks so the page runs immediately.
*/
const PLAYLIST = [
  { title: "The Grudge (Remastered)", file: "Media/01. The Grudge (Remastered).mp3" },
  { title: "New Beginnings", file: "Media/New Beginnings.mp3" },
  { title: "Dogs (Remix)", file: "Media/Dogs (Remix).mp3" }
  // ‚Ä¶ paste the rest of your 80-item list here ‚Ä¶
];

/* =========================
   2) STATION ID / JINGLE BREAKS
   =========================
   EXACT filenames from your MediaBreaks folder (mixed wav/mp3).
   Defaults to playing a break every 3rd song.
*/
const BREAKS = [
  "MediaBreaks/AishaPatelYouarelisteningtoK-Z-A-K.wav",
  "MediaBreaks/AmyYouarelisteningtoK-ZACHt.mp3",
  "MediaBreaks/en-US-Journey-D-K_ZACH___where_the_f.wav",
  "MediaBreaks/en-US-Journey-DYouaretunedintoK-Z-A-Kb.mp3",
  "MediaBreaks/en-US-News-NThisiskZ-A-Kbringingyou.mp3"
];

const BREAKS_CFG = {
  enabled: true,     // flip to false to disable all breaks quickly
  mode: "everyN",    // "betweenAll" | "everyN" | "random"
  n: 3,              // every 3rd song (used when mode === "everyN")
  prob: 0.33         // 33% chance after a song (used when mode === "random")
};

/* =========================
   3) HELPERS & STATE
   ========================= */
const pathToUrl = p => encodeURI(p).replace(/#/g,'%23'); // preserves spaces/() and escapes #
const fmt = s => { if (!isFinite(s)) return '0:00'; const m = (s/60)|0, sec = (s%60)|0; return m+':'+(sec<10?'0':'')+sec; };
const pick = arr => arr[Math.floor(Math.random()*arr.length)];

const audio = document.getElementById('audio');
const btnPrev = document.getElementById('btnPrev');
const btnPlay = document.getElementById('btnPlay');
const btnNext = document.getElementById('btnNext');
const btnLoop = document.getElementById('btnLoop');
const btnShuffle = document.getElementById('btnShuffle');
const btnMute = document.getElementById('btnMute');
const btnShare = document.getElementById('btnShare');
const vol = document.getElementById('vol');
const seek = document.getElementById('seek');
const title = document.getElementById('title');
const meta = document.getElementById('meta');
const list = document.getElementById('list');
const onAir = document.getElementById('onAir');
const counter = document.getElementById('counter');

let idx = 0;
let userScrubbing = false;

// Break / jingle state
const breakAudio = new Audio();
let isBreak = false;
let tracksSinceBreak = 0;

function shouldInsertBreak(){
  if (!BREAKS_CFG.enabled || audio.loop || BREAKS.length === 0) return false;
  if (BREAKS_CFG.mode === "betweenAll") return true;
  if (BREAKS_CFG.mode === "everyN"){
    tracksSinceBreak++;
    if (tracksSinceBreak >= BREAKS_CFG.n){ tracksSinceBreak = 0; return true; }
    return false;
  }
  if (BREAKS_CFG.mode === "random") return Math.random() < BREAKS_CFG.prob;
  return false;
}
function currentMediaEl(){ return isBreak ? breakAudio : audio; }

/* =========================
   4) PLAYLIST UI
   ========================= */
function renderList(){
  list.innerHTML = '';
  PLAYLIST.forEach((t,i)=>{
    const row = document.createElement('div');
    row.className = 'track';
    row.setAttribute('role','option');
    row.setAttribute('aria-selected', i===idx ? 'true':'false');
    row.innerHTML = `<span class="idx">${String(i+1).padStart(2,'0')}</span>
                     <div><div>${t.title}</div><div class="small">${t.file.replace(/^Media\//,'')}</div></div>`;
    row.addEventListener('click', ()=>{ if(isBreak){ breakAudio.pause(); isBreak=false; } load(i); play(); });
    list.appendChild(row);
  });
}
function updateActive(){
  [...list.children].forEach((el,i)=>{
    el.querySelector('.idx').classList.toggle('now', i===idx);
    el.setAttribute('aria-selected', i===idx ? 'true':'false');
  });
}

/* =========================
   5) CORE LOAD/NAV
   ========================= */
function load(i){
  idx = (i+PLAYLIST.length) % PLAYLIST.length;
  const tr = PLAYLIST[idx];
  audio.src = pathToUrl(tr.file);
  title.textContent = tr.title;
  counter.textContent = `${idx+1} of ${PLAYLIST.length}`;
  updateActive();
  // deep-link ?t=idx
  const url = new URL(location);
  url.searchParams.set('t', idx);
  history.replaceState({},'',url);
}
function play(){ currentMediaEl().play().catch(()=>{}); }
function pause(){ currentMediaEl().pause(); }
function next(){ load(idx+1); play(); }
function prev(){ load(idx-1); play(); }

/* =========================
   6) BREAK PLAYBACK
   ========================= */
async function playRandomBreakThenNext(){
  isBreak = true;
  const prevTitle = title.textContent;
  const prevMeta  = meta.textContent;

  // mirror volume/mute
  breakAudio.volume = audio.volume;
  breakAudio.muted  = audio.muted;

  const file = pick(BREAKS);
  title.textContent = "Station ID ‚Ä¢ KZAK";
  meta.textContent  = file.replace(/^MediaBreaks\//,'');

  breakAudio.src = pathToUrl(file);
  try{ await breakAudio.play(); }catch{}

  breakAudio.onended = () => {
    title.textContent = prevTitle;
    meta.textContent  = prevMeta;
    isBreak = false;
    next();
  };
}

/* =========================
   7) CONTROLS
   ========================= */
btnPlay.onclick = () => {
  const el = currentMediaEl();
  if (el.paused){ el.play(); } else { el.pause(); }
};
btnPrev.onclick = () => { if(isBreak){ breakAudio.pause(); isBreak=false; } prev(); };
btnNext.onclick = () => { if(isBreak){ breakAudio.pause(); isBreak=false; } next(); };
btnLoop.onclick = () => { audio.loop = !audio.loop; btnLoop.classList.toggle('pill', audio.loop); };
btnShuffle.onclick = () => {
  // in-place Fisher-Yates; keep current track pinned
  const current = PLAYLIST[idx];
  for (let i=PLAYLIST.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [PLAYLIST[i],PLAYLIST[j]]=[PLAYLIST[j],PLAYLIST[i]]; }
  idx = PLAYLIST.findIndex(t => t===current);
  renderList(); updateActive();
};
btnMute.onclick = () => {
  const now = !currentMediaEl().muted;
  audio.muted = now; breakAudio.muted = now;
  btnMute.classList.toggle('pill', now);
};
vol.oninput = e => { audio.volume = +e.target.value; breakAudio.volume = +e.target.value; };

seek.oninput = () => { userScrubbing = true; };
seek.onchange = e => { if(isFinite(audio.duration)) audio.currentTime = audio.duration * (+e.target.value/100); userScrubbing=false; };

btnShare.onclick = async () => {
  const tr = PLAYLIST[idx];
  const url = new URL(location.href);
  url.searchParams.set('t', idx);
  const shareData = { title: 'Listen with me ‚Äî KZAK', text: tr.title, url: url.toString() };
  try{
    if(navigator.share){ await navigator.share(shareData); }
    else throw 0;
  }catch{
    try{ await navigator.clipboard.writeText(url.toString()); alert('Link copied to clipboard!'); }
    catch{ location.href = `mailto:?subject=${encodeURIComponent('Listen with me ‚Äî '+tr.title)}&body=${encodeURIComponent(url.toString())}`; }
  }
};

/* =========================
   8) AUDIO EVENTS
   ========================= */
audio.addEventListener('play',  ()=>{ onAir.style.opacity=1; btnPlay.textContent='‚è∏Ô∏é Stop / Pause'; meta.textContent='Playing'; });
audio.addEventListener('pause', ()=>{ btnPlay.textContent='‚ñ∂Ô∏é Start Station'; meta.textContent='Paused'; });
audio.addEventListener('ended', ()=>{
  onAir.style.opacity=.55; meta.textContent='Finished';
  if (shouldInsertBreak()) playRandomBreakThenNext(); else next();
});
audio.addEventListener('timeupdate', ()=>{
  if (!userScrubbing && isFinite(audio.duration)){
    seek.value = (audio.currentTime / audio.duration) * 100;
    document.getElementById('elapsed').textContent = fmt(audio.currentTime);
    document.getElementById('remaining').textContent = '-' + fmt(Math.max(0,(audio.duration - audio.currentTime)));
  }
});

// reflect ON AIR for breakAudio too
breakAudio.addEventListener('play',  ()=>{ onAir.style.opacity=1; btnPlay.textContent='‚è∏Ô∏é Stop / Pause'; });
breakAudio.addEventListener('pause', ()=>{ btnPlay.textContent='‚ñ∂Ô∏é Start Station'; });

/* =========================
   9) INIT
   ========================= */
(function init(){
  renderList();
  const fromParam = parseInt(new URL(location.href).searchParams.get('t'),10);
  const startIdx = Number.isFinite(fromParam) ? Math.max(0, Math.min(PLAYLIST.length-1, fromParam)) : 0;
  load(startIdx);
})();
</script>
</body>
</html>

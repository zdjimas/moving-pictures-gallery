 <!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Moving Pictures — Museum Lobby</title>
<style>
  :root{
    --wall-deep:#221014; --wall-top:#2e0f13; --gold:#d8b765;
    --ink:#eceff4; --muted:#b7becd; --shadow:0 16px 40px rgba(0,0,0,.40);
    --tile-aspect: 3 / 4;
  }

  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    background:
      radial-gradient(1200px 600px at 85% -10%, rgba(255,220,150,.16), transparent 60%),
      radial-gradient(900px 560px at 10% 10%,  rgba(255,200,120,.12), transparent 58%),
      linear-gradient(180deg, var(--wall-top) 0%, var(--wall-deep) 40%, #1b0e12 100%),
      repeating-linear-gradient(90deg, rgba(255,255,255,.06) 0 2px, transparent 2px 120px) fixed;
  }
  .beams{position:fixed; inset:0; pointer-events:none; z-index:0;
    background:
      radial-gradient(500px 260px at 18% 0%, rgba(255,255,210,.20), transparent 60%),
      radial-gradient(540px 260px at 78% 0%, rgba(255,240,190,.16), transparent 60%);
    mix-blend-mode:screen;
  }
  body::before, body::after{content:""; position:fixed; left:0; right:0; z-index:0; pointer-events:none;}
  body::before{ top:0; height:18px; background:linear-gradient(180deg, #e7dcc3, #b9a67b 60%, #8f7846); box-shadow:0 4px 14px rgba(0,0,0,.35) inset }
  body::after{ bottom:0; height:120px; background:
      linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.45)),
      repeating-linear-gradient(45deg, rgba(255,255,255,.08) 0 6px, rgba(0,0,0,.08) 6px 12px),
      linear-gradient(180deg, #e9e7de, #cfc7b6 60%, #b8ae99);
    box-shadow:0 -10px 30px rgba(0,0,0,.35) inset;
  }

  .wrap{max-width:1200px;margin:0 auto;padding:28px 18px 120px; position:relative; z-index:1}
  h1{margin:0 0 10px;font-size:clamp(24px,3.2vw,40px);letter-spacing:.02em}
  .note{color:var(--muted);font-size:14px;margin:6px 0 24px}

  /* Dynamic exhibits list (single column, randomized spacing) */
  .exhibits{display:grid; gap:36px}

  /* Exhibit row with randomized plaque side */
  .exhibit{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:26px; align-items:start;
  }
  .exhibit.pl-left  .plaque-col{ order:1 } .exhibit.pl-left  .frame-col{ order:2 }
  .exhibit.pl-right .plaque-col{ order:2 } .exhibit.pl-right .frame-col{ order:1 }

  @media (max-width: 900px){
    .exhibit{ grid-template-columns: 1fr; }
    .plaque-col, .frame-col{ order:initial }
  }

  /* Plaque (left banner) with random width/tilt via CSS vars */
  .plaque-col{ transform: rotate(var(--pl-tilt, 0deg)); }
  .plaque{
    width: min(var(--plaqueW, 320px), 100%);
    background:linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.55));
    border:1px solid rgba(255,220,140,.25);
    border-left:6px solid var(--gold);
    border-radius:14px;
    padding:16px 16px 14px;
    margin-top: var(--plaqueTop, 0px);
    backdrop-filter: blur(3px);
    box-shadow: var(--shadow);
  }
  .plaque h2{margin:0 0 6px;font-size:clamp(18px,2.2vw,24px)}
  .plaque .room{margin:0 0 6px;color:#f3dfad;font-weight:600}
  .plaque p{margin:0 0 12px;color:#eae4d6;line-height:1.45}
  .cta{
    display:inline-flex; align-items:center; gap:8px;
    background:#121a20; color:#f2f5f9; border:1px solid #38424f;
    padding:10px 12px; border-radius:10px; text-decoration:none; cursor:pointer;
  }
  .cta[aria-disabled="true"]{ opacity:.55; cursor:not-allowed }
  .cta:hover{ background:#161f26 }

  /* Frame finishes (random) */
  .frame-wrap{filter:drop-shadow(0 18px 24px rgba(0,0,0,.35)); transform: rotate(var(--frame-tilt, 0deg));}
  .frame{
    position:relative; box-shadow:var(--shadow); border-radius:14px; border:10px solid transparent;
  }
  .finish-gilded .frame{
    background:
      linear-gradient(#0000,#0000) padding-box,
      conic-gradient(from 20deg,#6b4e0f,#caa54b 12%,#ffeb9c 24%,#d3ab4a 36%,#6b4e0f 48%,#e2c266 60%,#fff1b5 72%,#c3972e 84%,#6b4e0f) border-box;
  }
  .finish-ebony .frame{
    border-color:#0a0d12;
    background:
      linear-gradient(180deg,#0a0f14,#131a22) padding-box,
      linear-gradient(145deg, #1c232c, #090d12 60%, #1a212a) border-box;
  }
  .finish-brass .frame{
    background:
      linear-gradient(#0000,#0000) padding-box,
      conic-gradient(from -30deg,#3c2e14,#b49352,#6f582b,#d7b778,#4a3a18,#b49352) border-box;
    filter:saturate(1.06);
  }
  .finish-walnut .frame{
    background:
      linear-gradient(#0000,#0000) padding-box,
      linear-gradient(25deg, #3b2414 0%, #5a3820 30%, #7a4b2b 55%, #4b2d19 80%, #3b2414 100%) border-box;
  }
  .frame::after{content:"";position:absolute;inset:8px;border-radius:8px;border:2px solid #f4e8c7;pointer-events:none}
  .mat{margin:16px;background:#f4efe6;border:1px solid #ddd2be;border-radius:8px;
       box-shadow:inset 0 1px 0 rgba(255,255,255,.4), inset 0 -1px 0 rgba(0,0,0,.12)}
  .tile{position:relative;aspect-ratio:var(--tile-aspect);overflow:hidden;border:1px solid rgba(0,0,0,.25);
        background:#000;display:block;touch-action:manipulation;border-radius:6px}
  .thumb,.clip{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block;background:#000}
  .clip{opacity:0;transition:opacity .15s ease-out}
  .tile.is-previewing .clip,.tile.revealed .clip{opacity:1}
  .tile.revealed .thumb{opacity:0;pointer-events:none}
  .overlay{position:absolute;inset:auto 0 0 0;background:linear-gradient(180deg,transparent,rgba(0,0,0,.78));
           padding:12px 14px;display:flex;align-items:center;justify-content:space-between;gap:10px}
  .title{font-weight:600;font-size:14px}
  .badge{font-size:12px;color:#c5e4ff;background:rgba(124,198,255,.08);border:1px solid rgba(124,198,255,.3);
         padding:4px 8px;border-radius:999px}

  /* Lightbox */
  .lightbox{position:fixed;inset:0;background:rgba(8,10,14,.72);backdrop-filter:blur(6px);
            display:none;align-items:center;justify-content:center;padding:24px;z-index:50}
  .lightbox.open{display:flex}
  .lightbox-card{width:min(900px,92vw);background:#0f1218;border:1px solid #222936;border-radius:16px;overflow:hidden;box-shadow:var(--shadow)}
  .lightbox-head{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid #1b222e}
  .lightbox-title{font-weight:600}
  .x{border:0;background:transparent;color:#9aa0a6;font-size:22px;cursor:pointer}
  .player{position:relative;background:#000}
  .player video{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;background:#000}

  /* Intro overlay */
  .intro-overlay{ position:fixed; inset:0; z-index:9999; display:none; place-items:center;
                  background:rgba(10,12,16,.85); backdrop-filter:blur(6px) }
  .intro-overlay.open{ display:grid }
  .intro-shell{ width:min(900px,92vw); max-height:90vh; display:grid; gap:10px }
  .intro-video{ width:100%; height:auto; max-height:80vh; background:#000; display:block;
                border-radius:12px; box-shadow:0 18px 40px rgba(0,0,0,.5) }
  .intro-actions{ display:flex; justify-content:flex-end }
  .intro-skip{ border:1px solid #394355; background:#121a25; color:#e9ecf2;
               padding:8px 12px; border-radius:10px; cursor:pointer }
  .intro-skip:hover{ background:#17202c }
</style>
</head>
<body>
  <div class="beams" aria-hidden="true"></div>

  <div class="wrap">
    <h1>Moving Pictures — Museum Lobby</h1>
    <div class="note">Each visit rehangs the lobby slightly. Plaques sit left or right, frames tilt and finish vary—just like a living museum.</div>

    <section id="exhibits" class="exhibits"></section>
  </div>

  <!-- Intro overlay -->
  <div id="introOverlay" class="intro-overlay" role="dialog" aria-modal="true" aria-label="Room intro">
    <div class="intro-shell">
      <video id="introVideo"
             class="intro-video"
             playsinline webkit-playsinline
             preload="metadata"
             controlslist="nodownload noplaybackrate"
             disablepictureinpicture></video>
      <div class="intro-actions">
        <button id="skipIntro" class="intro-skip">Skip →</button>
      </div>
    </div>
  </div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Video player">
    <div class="lightbox-card">
      <div class="lightbox-head">
        <div class="lightbox-title" id="lbTitle">Title</div>
        <button class="x" id="lbClose" aria-label="Close">✕</button>
      </div>
      <div class="player">
        <video id="lbVideo" controls playsinline></video>
      </div>
    </div>
  </div>

<script>
/* ============ Data ============ */
/* Abstracts first; the rest can shuffle each load */
const ABSTRACTS = {
  key: 'abstracts',
  title: 'The Grudge on Dune',
  room: 'Abstracts, Tools & Ghouls',
  desc: 'Dark, rebellious remixes—surreal mechanics, ritual light, and riffs re-forged. Enter for the full series.',
  isActiveRoom: true,
  introSrc: 'room-abstract/media/GhoulsDoor.mp4',
  target:   'room-abstract/index.html',
  tile: { tiktok: 'https://www.tiktok.com/t/ZT63YRxNR/', poster: './IMG_0494.jpg' }
};

const OTHERS = [
  {
    key:'xavier',
    title:"Xavier's Perspectives",
    room:'Portraits in Motion',
    desc:'Intimate character studies that flicker between realism and dream. Faces, gestures, and mood as moving compositions.',
    mp4:'./xaviers-perspectives.mp4',
    poster:'./xaviers-perspectives-poster.png'
  },
  {
    key:'jazz',
    title:'Reflections from a Jazz Club',
    room:'Noir & Jazz Abstractions',
    desc:'Smoke, brass, and neon. Improvised camera rhythms meet graphic motifs in a low-lit synesthetic lounge.',
    mp4:'./Reflections from a Jazz Club.mp4',
    poster:'./Jazz.png'
  },
  {
    key:'vacancy',
    title:'Vacancy — AI cover (Dream Theater)',
    room:'Cinematic Covers',
    desc:'Classic tracks reimagined as moving paintings—lyric moods translated into light and motion.',
    mp4:'./Vacancy - an AI cover of Dream Theater.mp4',
    poster:'./Vacancy.png'
  },
  {
    key:'wings',
    title:'Wings for Marie',
    room:'Devotional Motion',
    desc:'Elegiac studies about memory and lift—where textures arc upward and time seems to glow.',
    mp4:'./Wings For Marie.mp4',
    poster:'./Wings.png'
  }
];

/* ============ Utilities ============ */
const rand = (min,max)=> Math.random()*(max-min)+min;
const choose = arr => arr[Math.floor(Math.random()*arr.length)];
function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
const FINISHES = ['finish-gilded','finish-ebony','finish-brass','finish-walnut'];

/* ============ Build one exhibit row ============ */
function buildExhibit(data){
  const ex = document.createElement('article');
  const plaqueLeft = Math.random() < 0.5;   // random side
  const finish = choose(FINISHES);
  const frameTilt = (rand(-0.35,0.35)).toFixed(3)+'deg';
  const plaqueTilt = (rand(-0.4,0.4)).toFixed(3)+'deg';
  const plaqueW = Math.round(rand(240, 340))+'px';
  const plaqueTop = Math.round(rand(0, 24))+'px';
  const spacing = Math.round(rand(16, 52)); // random vertical gap after this exhibit

  ex.className = `exhibit ${plaqueLeft ? 'pl-left':'pl-right'} ${finish}`;
  ex.style.marginBottom = spacing+'px';
  ex.style.setProperty('--frame-tilt', frameTilt);
  ex.style.setProperty('--pl-tilt', plaqueTilt);
  ex.style.setProperty('--plaqueW', plaqueW);
  ex.style.setProperty('--plaqueTop', plaqueTop);

  const plaque = document.createElement('div');
  plaque.className = 'plaque-col';
  plaque.innerHTML = `
    <div class="plaque">
      <h2>${data.title}</h2>
      <div class="room">Room: ${data.room}${data.isActiveRoom ? '' : ' (coming soon)'}</div>
      <p>${data.desc}</p>
      <div class="cta-row"></div>
    </div>
  `;

  const frameCol = document.createElement('div');
  frameCol.className = 'frame-col';
  frameCol.innerHTML = `
    <div class="frame-wrap">
      <div class="frame"><div class="mat">
        <article class="tile" tabindex="0"></article>
      </div></div>
    </div>
  `;

  // Tile content (MP4 hover vs TikTok)
  const tile = frameCol.querySelector('.tile');
  if (data.tile?.tiktok){
    tile.dataset.title = data.title;
    tile.dataset.tiktok = data.tile.tiktok;
    tile.innerHTML = `
      <img class="thumb" src="${data.tile.poster}" alt="Poster: ${data.title}" loading="lazy" />
      <div class="overlay"><div class="title">${data.title}</div><div class="badge">Click to watch on TikTok</div></div>
    `;
  } else {
    tile.dataset.title = data.title;
    tile.dataset.video = data.mp4;
    tile.innerHTML = `
      <img class="thumb" src="${data.poster}" alt="Poster: ${data.title}" loading="lazy" />
      <video class="clip" preload="metadata" playsinline muted></video>
      <div class="overlay"><div class="title">${data.title}</div><div class="badge">Hover to preview</div></div>
    `;
  }

  // CTA(s)
  const ctaRow = plaque.querySelector('.cta-row');
  if (data.isActiveRoom){
    ctaRow.innerHTML = `
      <a class="cta" href="${data.tile.tiktok}" target="_blank" rel="noopener">▶︎ Watch on TikTok</a>
      <button class="cta" id="enterAbstracts" type="button"
              data-intro="${data.introSrc}"
              data-target="${data.target}"
              aria-haspopup="dialog">🏛 Enter this Room</button>
    `;
  } else {
    ctaRow.innerHTML = `<button class="cta" aria-disabled="true" title="Room under construction">▶︎ Enter Room (Coming Soon)</button>`;
  }

  ex.appendChild(plaque);
  ex.appendChild(frameCol);
  return ex;
}

/* ============ Render ============ */
const exhibitsEl = document.getElementById('exhibits');
// Abstracts first; others randomized
const order = [ABSTRACTS, ...shuffle([...OTHERS])];
order.forEach(d => exhibitsEl.appendChild(buildExhibit(d)));

/* ============ Interactions ============ */
/* Hover previews for MP4 tiles + poster-once */
const tiles = document.querySelectorAll('.tile');
const safeSrc = (p)=> encodeURI(p);

function ensureVideo(tile){
  const v = tile.querySelector('video.clip');
  if (!v) return null;
  if (!v.dataset.bound){
    v.dataset.bound = '1';
    v.src = safeSrc(tile.dataset.video);
    v.preload = 'metadata';
    v.playsInline = true;
    v.setAttribute('playsinline','');
    v.setAttribute('webkit-playsinline','');
  }
  return v;
}
function reveal(tile){ if (!tile.classList.contains('revealed')) tile.classList.add('revealed'); }
function startPreview(tile, userGesture=false){
  if (tile.dataset.tiktok) return;
  const v = ensureVideo(tile); if (!v) return;
  reveal(tile);
  v.muted = true; // lobby previews muted by default
  const p = v.play(); if (userGesture && p) p.catch(()=>{});
  tile.classList.add('is-previewing');
}
function stopPreview(tile){ const v = tile.querySelector('video.clip'); if (v) v.pause(); tile.classList.remove('is-previewing'); }

tiles.forEach(tile=>{
  tile.addEventListener('pointerenter', ()=>startPreview(tile,false));
  tile.addEventListener('pointerleave', ()=>stopPreview(tile));
  tile.addEventListener('pointerdown', ()=>startPreview(tile,true));
  tile.addEventListener('pointerup',   ()=>stopPreview(tile));
  tile.addEventListener('pointercancel',()=>stopPreview(tile));
  tile.addEventListener('touchstart', ()=>startPreview(tile,true), {passive:true});
  tile.addEventListener('touchend',   ()=>stopPreview(tile), {passive:true});
  tile.addEventListener('touchcancel',()=>stopPreview(tile), {passive:true});
});

/* Lightbox for local MP4 tiles only */
const lb = document.getElementById('lightbox');
const lbVideo = document.getElementById('lbVideo');
const lbTitle = document.getElementById('lbTitle');
const lbClose = document.getElementById('lbClose');

function openLightboxFromTile(tile){
  if (tile.dataset.tiktok){
    window.open(tile.dataset.tiktok, '_blank', 'noopener');
    return;
  }
  const vPrev = tile.querySelector('video.clip');
  lbTitle.textContent = tile.dataset.title || 'Untitled';
  lbVideo.src = safeSrc(tile.dataset.video);
  lb.classList.add('open');

  const resumeAt = vPrev && !isNaN(vPrev.currentTime) ? vPrev.currentTime : 0;
  lbVideo.addEventListener('loadedmetadata', function onMeta(){
    lbVideo.removeEventListener('loadedmetadata', onMeta);
    try { lbVideo.currentTime = resumeAt; } catch(e){}
  });
}
function closeLightbox(){ lbVideo.pause(); lbVideo.src=''; lb.classList.remove('open'); }

lbClose.addEventListener('click', closeLightbox);
lb.addEventListener('click', (e)=>{ if(e.target===lb) closeLightbox(); });
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && lb.classList.contains('open')) closeLightbox(); });

tiles.forEach(tile=>{
  tile.addEventListener('click', ()=>openLightboxFromTile(tile));
  tile.addEventListener('keyup', (e)=>{ if(e.key==='Enter' || e.key===' ') openLightboxFromTile(tile); });
});

/* Intro overlay (Abstracts room) */
(function(){
  const btn = document.getElementById('enterAbstracts');
  if(!btn) return;

  const overlay = document.getElementById('introOverlay');
  const video   = document.getElementById('introVideo');
  const skipBtn = document.getElementById('skipIntro');

  function resolveTarget(){
    const raw = btn.dataset.target || 'room-abstract/index.html';
    try { return new URL(raw, window.location.href).href; }
    catch { return raw; }
  }
  function cleanup(){
    try { video.pause(); } catch(e){}
    video.removeAttribute('src'); video.load();
    overlay.classList.remove('open');
    document.body.style.overflow = '';
  }
  function goNow(){
    const href = resolveTarget();
    cleanup();
    window.location.assign(href);
  }

  btn.addEventListener('click', async (e)=>{
    e.preventDefault(); e.stopPropagation();
    const introSrc = btn.dataset.intro;
    if(!introSrc){ goNow(); return; }

    overlay.classList.add('open');
    document.body.style.overflow = 'hidden';
    video.src = introSrc;
    video.setAttribute('playsinline',''); video.setAttribute('webkit-playsinline','');
    video.muted = false;
    video.volume = 1.0;

    let started = false;
    const bail = setTimeout(()=>{ if(!started) goNow(); }, 3500);
    try { await video.play(); started = true; clearTimeout(bail); } catch { goNow(); return; }
    video.addEventListener('ended', ()=>goNow(), {once:true});
    skipBtn.onclick = ()=>goNow();
  }, {passive:false});
})();
</script>
</body>
</html>
